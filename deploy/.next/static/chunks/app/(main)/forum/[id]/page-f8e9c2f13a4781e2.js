(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4685],{3004:function(e,s,a){Promise.resolve().then(a.bind(a,3336))},3336:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return v}});var t=a(7437),n=a(7138),r=a(6463),l=a(2265),i=a(6013),c=a(495),d=a(3146),m=a(7440),x=a(5137),o=a(2022),u=a(5733),h=a(7390),p=a(994);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,a(8030).Z)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);var j=a(5904),g=a.n(j),N=a(5591);function v(){var e;let s=(0,r.useParams)(),a=(0,r.useRouter)(),j=s.id,[v,b]=(0,l.useState)(null),[y,w]=(0,l.useState)([]),[Z,k]=(0,l.useState)(""),[z,_]=(0,l.useState)(!0),[C,E]=(0,l.useState)(!1);(0,l.useEffect)(()=>{S(),M()},[j]);let S=async()=>{try{let e=await N.mJ.getTopic(parseInt(j));b(e)}catch(s){let e=s instanceof Error?s.message:"话题不存在";(0,N.x2)(e),a.push("/forum")}finally{_(!1)}},M=async()=>{try{let e=await N.mJ.getComments(parseInt(j));w(e)}catch(e){console.error("加载评论失败:",e)}},q=e=>g().sanitize(e),J=async()=>{if(Z.trim()){if(!N.iJ.isAuthenticated()){(0,N.x2)("请先登录"),a.push("/login");return}E(!0);try{let e=await N.mJ.addComment(parseInt(j),{content:Z});w([...y,e]),k(""),(0,N.s$)("评论发布成功")}catch(s){let e=s instanceof Error?s.message:"评论失败";(0,N.x2)(e)}finally{E(!1)}}};return z?(0,t.jsx)("div",{className:"mx-auto max-w-4xl px-6 py-12 lg:px-8",children:(0,t.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,t.jsx)("div",{className:"h-8 bg-muted rounded w-3/4"}),(0,t.jsx)("div",{className:"h-32 bg-muted rounded"})]})}):v?(0,t.jsxs)("div",{className:"mx-auto max-w-4xl px-6 py-12 lg:px-8",children:[(0,t.jsx)(c.z,{variant:"ghost",asChild:!0,className:"mb-6",children:(0,t.jsxs)(n.default,{href:"/forum",children:[(0,t.jsx)(x.Z,{className:"mr-2 h-4 w-4"}),"返回论坛"]})}),(0,t.jsx)(i.Zb,{className:"mb-8 gradient-border",children:(0,t.jsxs)(i.aY,{className:"p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-4",children:[(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.Z,{className:"h-4 w-4"}),q((null===(e=v.author)||void 0===e?void 0:e.name)||"匿名")]}),(0,t.jsx)("span",{children:"\xb7"}),(0,t.jsx)("span",{children:(0,m.p6)(v.created_at)}),(0,t.jsx)("span",{children:"\xb7"}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4"}),v.views," 次浏览"]})]}),(0,t.jsx)("h1",{className:"text-2xl font-bold tracking-tight mb-4",children:q(v.title)}),(0,t.jsx)("div",{className:"prose prose-invert max-w-none",children:v.content.split("\n").map((e,s)=>(0,t.jsx)("p",{className:"text-muted-foreground whitespace-pre-wrap",children:q(e)},s))})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,t.jsx)(h.Z,{className:"h-5 w-5"}),(0,t.jsxs)("span",{className:"font-semibold",children:[y.length," 条评论"]})]}),(0,t.jsx)(i.Zb,{className:"mb-8",children:(0,t.jsxs)(i.aY,{className:"p-4",children:[(0,t.jsx)(d.g,{placeholder:"写下你的评论...",value:Z,onChange:e=>k(e.target.value),className:"min-h-[100px] mb-4 input-glow"}),(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)(c.z,{onClick:J,disabled:C||!Z.trim(),children:[(0,t.jsx)(p.Z,{className:"mr-2 h-4 w-4"}),C?"发布中...":"发布评论"]})})]})}),(0,t.jsx)("div",{className:"space-y-4",children:y.map(e=>{var s;return(0,t.jsx)(i.Zb,{className:"glass-card",children:(0,t.jsx)(i.aY,{className:"p-4",children:(0,t.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-primary/10",children:(0,t.jsx)(o.Z,{className:"h-4 w-4 text-primary"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-semibold",children:q((null===(s=e.author)||void 0===s?void 0:s.name)||"匿名")}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,m.p6)(e.created_at)})]}),(0,t.jsx)("p",{className:"mt-1 text-muted-foreground",children:q(e.content)}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-4",children:[(0,t.jsxs)("button",{className:"flex items-center gap-1 text-sm text-muted-foreground hover:text-primary transition-colors",children:[(0,t.jsx)(f,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:e.likes})]}),(0,t.jsx)("button",{className:"text-sm text-muted-foreground hover:text-primary transition-colors",children:"回复"})]})]})]})})})},e.id)})})]}):(0,t.jsx)("div",{className:"mx-auto max-w-4xl px-6 py-12 lg:px-8",children:(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"话题不存在"})})})}},3146:function(e,s,a){"use strict";a.d(s,{g:function(){return l}});var t=a(7437),n=a(2265),r=a(7440);let l=n.forwardRef((e,s)=>{let{className:a,...n}=e;return(0,t.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-input px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-300",a),ref:s,...n})});l.displayName="Textarea"},5733:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(8030).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},7390:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(8030).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},994:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let t=(0,a(8030).Z)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])}},function(e){e.O(0,[4868,231,2574,6658,2971,7023,1744],function(){return e(e.s=3004)}),_N_E=e.O()}]);